#!/usr/bin/env bash

# Check that we have the tools required available, otherwise exit with no error.
# Use command -v, not which, which is deprecated.
[[ -z $(command -v amixer) ]] && echo "Missing amixer; doing nothing." && exit 0
[[ -z $(command -v alsactl) ]] && echo "Missing alsactl; doing nothing." && exit 0
[[ -z $(command -v aplay) ]] && echo "Missing aplay; doing nothing." && exit 0

mixer_cmds() {
	parm=${3:-on}
	echo "sset '$1' '$2' '$parm'"
	echo "sset '$1' '$parm'"
}

if [ -f "$HOME/.config/sound.conf" ]; then
	alsactl restore -f "$HOME/.config/sound.conf"
else
	# get card num
	#card=`echo $1 | sed 's/[^0-9]*//g'`
	card1=$(aplay -l | grep "device 0" | awk '{print $3}')
	#echo $card

	# ES8388 Audio Codec (DShanPI A1)
	for card in $card1; do (
		# ES8388 specific configuration
		amixer -c "$card" cset numid=70 1 2>/dev/null || true           # Left PGA Mux
		amixer -c "$card" cset numid=71 1 2>/dev/null || true           # Right PGA Mux
		amixer -c "$card" cset numid=52 8 2>/dev/null || true           # Left Channel Capture Volume
		amixer -c "$card" cset numid=53 8 2>/dev/null || true           # Right Channel Capture Volume
		amixer -c "$card" cset numid=69 1 2>/dev/null || true           # Headset Mic Switch
		amixer -c "$card" cset numid=66 1 2>/dev/null || true           # Headphone Switch
		amixer -c "$card" cset numid=67 1 2>/dev/null || true           # Speaker Switch
		amixer -c "$card" cset numid=80 1 2>/dev/null || true           # OUT1 Switch
		amixer -c "$card" cset numid=81 1 2>/dev/null || true           # OUT2 Switch
		amixer -c "$card" cset numid=56 150 2>/dev/null || true         # PCM Volume
		amixer -c "$card" cset numid=59 30 2>/dev/null || true          # Output 1 Playback Volume
		amixer -c "$card" cset numid=60 30 2>/dev/null || true          # Output 2 Playback Volume
	) | amixer -c "$card" --stdin > /dev/null 2>&1; done
fi
